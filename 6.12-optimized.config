# ==================================================
# OpenWrt 6.12 配置 - x86_64 虚拟机 (深度优化版 v2)
# ==================================================

# 目标平台配置
CONFIG_TARGET_x86=y
CONFIG_TARGET_x86_64=y
CONFIG_TARGET_x86_64_DEVICE_generic=y

# 固件镜像配置
CONFIG_GRUB_IMAGES=y
CONFIG_PACKAGE_grub2-efi=y
CONFIG_TARGET_IMAGES_GZIP=y
CONFIG_TARGET_ROOTFS_PARTSIZE=512
# 精简镜像大小
CONFIG_TARGET_ROOTFS_SQUASHFS=y

# ==================================================
# 内核性能优化
# ==================================================
# CPU 调度器优化
CONFIG_KERNEL_CFS_BANDWIDTH=y
CONFIG_KERNEL_CGROUP_SCHED=y
CONFIG_KERNEL_FAIR_GROUP_SCHED=y

# 内存管理优化
CONFIG_KERNEL_TRANSPARENT_HUGEPAGE=y
CONFIG_KERNEL_TRANSPARENT_HUGEPAGE_ALWAYS=y
CONFIG_KERNEL_MEMORY_FAILURE=y
CONFIG_KERNEL_MEMCG=y
CONFIG_KERNEL_MEMCG_SWAP=y

# 文件系统优化
CONFIG_KERNEL_EXT4_FS_POSIX_ACL=y
CONFIG_KERNEL_EXT4_FS_SECURITY=y
CONFIG_KERNEL_FS_POSIX_ACL=y
CONFIG_KERNEL_SQUASHFS_XATTR=y

# 网络栈优化
CONFIG_KERNEL_NET_SCHED=y
CONFIG_KERNEL_NET_CLS_CGROUP=y
CONFIG_KERNEL_CGROUP_NET_PRIO=y
CONFIG_KERNEL_BPF_SYSCALL=y

# ==================================================
# 虚拟机专用优化
# ==================================================
# VirtIO 全套驱动
CONFIG_PACKAGE_kmod-virtio=y
CONFIG_PACKAGE_kmod-virtio-net=y
CONFIG_PACKAGE_kmod-virtio-blk=y
CONFIG_PACKAGE_kmod-virtio-scsi=y
CONFIG_PACKAGE_kmod-virtio-pci=y
CONFIG_PACKAGE_kmod-virtio-mmio=y
CONFIG_PACKAGE_kmod-virtio-balloon=y

# QEMU Guest Agent
CONFIG_PACKAGE_qemu-ga=y

# 虚拟机网络驱动（兼容）
CONFIG_PACKAGE_kmod-vmxnet3=y
CONFIG_PACKAGE_kmod-e1000=y
CONFIG_PACKAGE_kmod-e1000e=y

# ==================================================
# 基本系统工具（精简版）
# ==================================================
CONFIG_PACKAGE_curl=y
CONFIG_PACKAGE_nano=y
CONFIG_PACKAGE_wget-ssl=y
CONFIG_PACKAGE_htop=y
CONFIG_PACKAGE_iftop=y
CONFIG_PACKAGE_tcpdump=y

# ==================================================
# 网络功能
# ==================================================
# IPv6 支持
CONFIG_PACKAGE_ipv6helper=y
CONFIG_PACKAGE_odhcpd-ipv6only=y
CONFIG_PACKAGE_odhcp6c=y

# SSH
CONFIG_PACKAGE_openssh-sftp-server=y

# 防火墙
CONFIG_PACKAGE_iptables-nft=y
CONFIG_PACKAGE_iptables-mod-tproxy=y
CONFIG_PACKAGE_iptables-mod-extra=y
CONFIG_PACKAGE_kmod-ipt-tproxy=y
CONFIG_PACKAGE_kmod-nft-tproxy=y

# ==================================================
# DNS 架构（双DNS系统）
# ==================================================
# 基础 DNS
CONFIG_PACKAGE_dnsmasq-full=y

# MosDNS - 主 DNS (端口 5353)
CONFIG_PACKAGE_mosdns=y
CONFIG_PACKAGE_luci-app-mosdns=y
CONFIG_PACKAGE_luci-i18n-mosdns-zh-cn=y
CONFIG_PACKAGE_v2ray-geoip=y
CONFIG_PACKAGE_v2ray-geosite=y

# SmartDNS - 辅助 DNS (端口 5354)
CONFIG_PACKAGE_smartdns=y
CONFIG_PACKAGE_luci-app-smartdns=y
CONFIG_PACKAGE_luci-i18n-smartdns-zh-cn=y

# DNS 工具
CONFIG_PACKAGE_bind-dig=y
CONFIG_PACKAGE_drill=y

# ==================================================
# LuCI 界面
# ==================================================
CONFIG_PACKAGE_luci=y
CONFIG_PACKAGE_luci-base=y
CONFIG_PACKAGE_luci-mod-admin-full=y
CONFIG_PACKAGE_luci-theme-argon=y
CONFIG_PACKAGE_luci-proto-ipv6=y
CONFIG_PACKAGE_luci-proto-ppp=y

# ==================================================
# SSR-Plus 精简优化版
# ==================================================
CONFIG_PACKAGE_luci-app-ssr-plus=y
CONFIG_PACKAGE_luci-i18n-ssr-plus-zh-cn=y

# 核心：使用 Rust 版本 (高性能)
CONFIG_PACKAGE_shadowsocks-rust-sslocal=y
CONFIG_PACKAGE_shadowsocks-rust-ssserver=y

# SSR 支持（精简）
CONFIG_PACKAGE_shadowsocksr-libev-ssr-local=y
CONFIG_PACKAGE_shadowsocksr-libev-ssr-redir=y

# V2ray/Xray (选择一个)
CONFIG_PACKAGE_xray-core=y
CONFIG_PACKAGE_xray-plugin=y

# Trojan (精简)
CONFIG_PACKAGE_trojan-plus=y

# 代理辅助
CONFIG_PACKAGE_simple-obfs-client=y
CONFIG_PACKAGE_dns2socks=y
CONFIG_PACKAGE_dns2tcp=y
CONFIG_PACKAGE_microsocks=y
CONFIG_PACKAGE_ipt2socks=y
CONFIG_PACKAGE_tcping=y

# 透明代理
CONFIG_PACKAGE_redsocks2=y
CONFIG_PACKAGE_chinadns-ng=y

# ==================================================
# 网络性能加速
# ==================================================
# TCP 拥塞控制
CONFIG_PACKAGE_kmod-tcp-bbr=y
CONFIG_PACKAGE_kmod-tcp-hybla=y

# Netfilter 优化
CONFIG_PACKAGE_kmod-nf-conntrack-netlink=y
CONFIG_PACKAGE_kmod-nfnetlink=y
CONFIG_PACKAGE_kmod-nft-nat=y

# 流量加速引擎（二选一）
CONFIG_PACKAGE_kmod-shortcut-fe=y
CONFIG_PACKAGE_kmod-shortcut-fe-cm=y

# ==================================================
# 依赖库（精简版）
# ==================================================
CONFIG_PACKAGE_libpthread=y
CONFIG_PACKAGE_libpcre=y
CONFIG_PACKAGE_zlib=y
CONFIG_PACKAGE_libev=y
CONFIG_PACKAGE_libmbedtls=y
CONFIG_PACKAGE_libsodium=y
CONFIG_PACKAGE_libudns=y
CONFIG_PACKAGE_libcap-ng=y

# 加密库
CONFIG_PACKAGE_libopenssl=y
CONFIG_PACKAGE_libopenssl-conf=y
CONFIG_PACKAGE_openssl-util=y

# 压缩库（精简）
CONFIG_PACKAGE_liblz4=y
CONFIG_PACKAGE_libzstd=y

# ==================================================
# 系统监控（可选）
# ==================================================
CONFIG_PACKAGE_iperf3=y
CONFIG_PACKAGE_vnstat2=y
CONFIG_PACKAGE_vnstati2=y
CONFIG_PACKAGE_luci-app-vnstat2=y

# UPnP
CONFIG_PACKAGE_miniupnpd-nftables=y
CONFIG_PACKAGE_luci-app-upnp=y

# ==================================================
# 性能优化选项
# ==================================================
# 编译优化
CONFIG_KERNEL_CC_OPTIMIZE_FOR_PERFORMANCE=y
CONFIG_TARGET_OPTIONS=y
CONFIG_TARGET_OPTIMIZATION="-O3 -pipe -march=x86-64-v2"

# Strip 调试信息（减小体积）
CONFIG_STRIP_KERNEL_EXPORTS=y
CONFIG_USE_MKLIBS=y

# ==================================================
# 禁用不需要的功能（减小体积和提升性能）
# ==================================================
# CONFIG_PACKAGE_kmod-usb-core is not set
# CONFIG_PACKAGE_kmod-usb2 is not set
# CONFIG_PACKAGE_kmod-usb3 is not set
# CONFIG_PACKAGE_kmod-sound-core is not set
# CONFIG_PACKAGE_kmod-bluetooth is not set

# ==================================================
# 配置结束
# ==================================================

# ==================================================
# OpenWrt 6.12 旁路由专用极简版
# 功能：透明代理 + DNS 分流（不做主路由）
# ==================================================

CONFIG_MODULES=y
CONFIG_HAVE_DOT_CONFIG=y

# ┌─────────────────────────────────────────────┐
# │ 目标平台                                      │
# └─────────────────────────────────────────────┘
CONFIG_TARGET_x86=y
CONFIG_TARGET_x86_64=y
CONFIG_TARGET_x86_64_DEVICE_generic=y

# ┌─────────────────────────────────────────────┐
# │ 镜像格式（极简）                              │
# └─────────────────────────────────────────────┘
CONFIG_GRUB_IMAGES=y
CONFIG_GRUB_TIMEOUT="1"
CONFIG_TARGET_IMAGES_GZIP=y
CONFIG_TARGET_ROOTFS_PARTSIZE=200
CONFIG_TARGET_KERNEL_PARTSIZE=32
CONFIG_TARGET_ROOTFS_SQUASHFS=y
CONFIG_TARGET_SQUASHFS_BLOCK_SIZE=1024

# 不需要 EFI
# CONFIG_EFI_IMAGES is not set
# CONFIG_PACKAGE_grub2-efi is not set

# ┌─────────────────────────────────────────────┐
# │ 内核性能优化                                  │
# └─────────────────────────────────────────────┘
CONFIG_KVM_GUEST=y
CONFIG_PARAVIRT=y
CONFIG_HYPERVISOR_GUEST=y

# CPU 性能模式
CONFIG_CPU_FREQ=y
CONFIG_CPU_FREQ_DEFAULT_GOV_PERFORMANCE=y
CONFIG_CPU_FREQ_GOV_PERFORMANCE=y

# 内存性能
CONFIG_PACKAGE_zram-swap=y
CONFIG_ZRAM_DEF_COMP_LZ4=y

# 内核抢占（低延迟）
CONFIG_KERNEL_PREEMPT=y

# 高精度定时器
CONFIG_KERNEL_HRTIMER=y

# 禁用不需要的内核功能
# CONFIG_KERNEL_CGROUPS is not set
# CONFIG_KERNEL_NAMESPACES is not set

# ┌─────────────────────────────────────────────┐
# │ 网卡驱动（最小化）                            │
# └─────────────────────────────────────────────┘
CONFIG_PACKAGE_kmod-virtio-net=y
CONFIG_PACKAGE_kmod-virtio-blk=y
CONFIG_PACKAGE_kmod-e1000=y

# ┌─────────────────────────────────────────────┐
# │ 网络性能加速                                  │
# └─────────────────────────────────────────────┘
# TCP BBR 拥塞控制
CONFIG_PACKAGE_kmod-tcp-bbr=y

# SFE 流量加速（旁路由性能关键）
CONFIG_PACKAGE_kmod-shortcut-fe=y
CONFIG_PACKAGE_kmod-shortcut-fe-cm=y
CONFIG_PACKAGE_kmod-fast-classifier=y

# Netfilter 性能优化
CONFIG_PACKAGE_kmod-nf-conntrack=y
CONFIG_PACKAGE_kmod-nf-flow=y

# 网卡多队列支持
CONFIG_PACKAGE_irqbalance=y

# ┌─────────────────────────────────────────────┐
# │ 防火墙（旁路由只需要 TPROXY）                 │
# └─────────────────────────────────────────────┘
CONFIG_PACKAGE_iptables=y
CONFIG_PACKAGE_iptables-mod-tproxy=y
CONFIG_PACKAGE_kmod-ipt-tproxy=y
CONFIG_PACKAGE_kmod-nf-conntrack=y

# 旁路由不需要 NAT
# CONFIG_PACKAGE_iptables-mod-nat-extra is not set
# CONFIG_PACKAGE_kmod-ipt-nat is not set

# ┌─────────────────────────────────────────────┐
# │ SSR-Plus（旁路由核心）                        │
# └─────────────────────────────────────────────┘
CONFIG_PACKAGE_luci-app-ssr-plus=y
CONFIG_PACKAGE_luci-i18n-ssr-plus-zh-cn=y

# Xray 全协议支持
CONFIG_PACKAGE_xray-core=y
CONFIG_PACKAGE_v2ray-geoip=y
CONFIG_PACKAGE_v2ray-geosite=y

# SS-Rust 高性能
CONFIG_PACKAGE_shadowsocks-rust-sslocal=y

# 透明代理
CONFIG_PACKAGE_ipt2socks=y
CONFIG_PACKAGE_chinadns-ng=y
CONFIG_PACKAGE_resolveip=y

# ┌─────────────────────────────────────────────┐
# │ DNS 分流（旁路由关键）                        │
# └─────────────────────────────────────────────┘
CONFIG_PACKAGE_mosdns=y
CONFIG_PACKAGE_luci-app-mosdns=y
CONFIG_PACKAGE_luci-i18n-mosdns-zh-cn=y

CONFIG_PACKAGE_smartdns=y
CONFIG_PACKAGE_luci-app-smartdns=y
CONFIG_PACKAGE_luci-i18n-smartdns-zh-cn=y

# dnsmasq 精简（旁路由不做 DHCP）
CONFIG_PACKAGE_dnsmasq-full=y
CONFIG_PACKAGE_dnsmasq_full_ipset=y
# CONFIG_PACKAGE_dnsmasq_full_dhcp is not set
# CONFIG_PACKAGE_dnsmasq_full_dhcpv6 is not set

# ┌─────────────────────────────────────────────┐
# │ 基础工具                                      │
# └─────────────────────────────────────────────┘
CONFIG_PACKAGE_curl=y
CONFIG_PACKAGE_nano=y

# ┌─────────────────────────────────────────────┐
# │ LuCI 界面                                     │
# └─────────────────────────────────────────────┘
CONFIG_PACKAGE_luci=y
CONFIG_PACKAGE_luci-base=y
CONFIG_PACKAGE_luci-mod-admin-full=y
CONFIG_PACKAGE_luci-theme-argon=y
CONFIG_PACKAGE_luci-i18n-base-zh-cn=y
CONFIG_PACKAGE_luci-i18n-firewall-zh-cn=y

# UPnP
CONFIG_PACKAGE_miniupnpd=y
CONFIG_PACKAGE_luci-app-upnp=y
CONFIG_PACKAGE_luci-i18n-upnp-zh-cn=y

# ┌─────────────────────────────────────────────┐
# │ 旁路由不需要的功能                            │
# └─────────────────────────────────────────────┘

# DHCP/路由（主路由负责）
# CONFIG_PACKAGE_odhcpd is not set
# CONFIG_PACKAGE_odhcpd-ipv6only is not set
# CONFIG_PACKAGE_odhcp6c is not set
# CONFIG_PACKAGE_ipv6helper is not set
# CONFIG_PACKAGE_6in4 is not set
# CONFIG_PACKAGE_6rd is not set
# CONFIG_PACKAGE_6to4 is not set

# PPP 拨号（主路由负责）
# CONFIG_PACKAGE_ppp is not set
# CONFIG_PACKAGE_ppp-mod-pppoe is not set
# CONFIG_PACKAGE_luci-proto-ppp is not set

# IPv6（旁路由一般不需要）
# CONFIG_PACKAGE_luci-proto-ipv6 is not set
# CONFIG_PACKAGE_ip6tables is not set

# 无线
# CONFIG_PACKAGE_hostapd is not set
# CONFIG_PACKAGE_wpad is not set
# CONFIG_PACKAGE_kmod-cfg80211 is not set
# CONFIG_PACKAGE_kmod-mac80211 is not set

# USB
# CONFIG_PACKAGE_kmod-usb-core is not set
# CONFIG_PACKAGE_kmod-usb2 is not set
# CONFIG_PACKAGE_kmod-usb3 is not set

# 文件共享
# CONFIG_PACKAGE_samba4-server is not set
# CONFIG_PACKAGE_kmod-fs-nfs is not set

# 物理网卡
# CONFIG_PACKAGE_kmod-igc is not set
# CONFIG_PACKAGE_kmod-r8125 is not set
# CONFIG_PACKAGE_kmod-r8168 is not set
# CONFIG_PACKAGE_kmod-igb is not set

# 其他臃肿
# CONFIG_PACKAGE_luci-app-ddns is not set
# CONFIG_PACKAGE_luci-app-zerotier is not set
# CONFIG_PACKAGE_luci-app-frpc is not set
# CONFIG_PACKAGE_luci-app-dockerman is not set
# CONFIG_PACKAGE_collectd is not set
# CONFIG_PACKAGE_nload is not set

# ┌─────────────────────────────────────────────┐
# │ 禁用有依赖问题的包                            │
# └─────────────────────────────────────────────┘
# CONFIG_PACKAGE_luci-app-vsftpd is not set
# CONFIG_PACKAGE_vsftpd is not set
# CONFIG_PACKAGE_luci-app-dogcom is not set
# CONFIG_PACKAGE_dogcom is not set
# CONFIG_PACKAGE_luci-app-tencentcloud-cos is not set
# CONFIG_PACKAGE_luci-app-webd is not set
# CONFIG_PACKAGE_webd is not set
# CONFIG_PACKAGE_luci-app-transmission is not set
# CONFIG_PACKAGE_transmission-daemon is not set
# CONFIG_PACKAGE_luci-ssl-nginx is not set
# CONFIG_PACKAGE_nginx is not set
# CONFIG_PACKAGE_natflow is not set

# ┌─────────────────────────────────────────────┐
# │ 编译优化（性能优先）                          │
# └─────────────────────────────────────────────┘
CONFIG_KERNEL_BUILD_DOMAIN="vm"
CONFIG_KERNEL_BUILD_USER="openwrt"

# GCC 优化
CONFIG_DEVEL=y
CONFIG_TOOLCHAINOPTS=y
CONFIG_GCC_USE_GRAPHITE=y
CONFIG_TARGET_OPTIONS=y
CONFIG_TARGET_OPTIMIZATION="-O3 -pipe -march=x86-64-v2"

# 关闭调试（提升性能）
# CONFIG_KERNEL_DEBUG_FS is not set
# CONFIG_KERNEL_DEBUG_KERNEL is not set
# CONFIG_KERNEL_DEBUG_INFO is not set
# CONFIG_KERNEL_KALLSYMS is not set
# CONFIG_KERNEL_SWAP is not set
# CONFIG_KERNEL_PRINTK_TIME is not set

# Strip 优化
CONFIG_USE_MKLIBS=y
CONFIG_STRIP_KERNEL_EXPORTS=y

# ==================================================
# 旁路由专用 | 预计镜像：90~110MB | 内存：70~90MB
# ==================================================

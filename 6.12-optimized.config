# ==================================================
# OpenWrt 6.12 优化配置 - Linux虚拟机专用版
# 针对 KVM/QEMU/Proxmox 等虚拟化平台优化
# 主要功能：SSR-Plus + MosDNS + SmartDNS
# ==================================================
# ┌─────────────────────────────────────────────┐
# │ 目标平台配置 │
# └─────────────────────────────────────────────┘
CONFIG_TARGET_x86=y
CONFIG_TARGET_x86_64=y
CONFIG_TARGET_x86_64_DEVICE_generic=y
# ┌─────────────────────────────────────────────┐
# │ 固件镜像构建配置 │
# └─────────────────────────────────────────────┘
CONFIG_GRUB_IMAGES=y
CONFIG_GRUB_TIMEOUT="3"
CONFIG_GRUB_TITLE="OpenWrt 6.12 Optimized"
CONFIG_PACKAGE_grub2-efi=y
CONFIG_TARGET_IMAGES_GZIP=y
CONFIG_TARGET_ROOTFS_PARTSIZE=1024
CONFIG_TARGET_KERNEL_PARTSIZE=32
# ┌─────────────────────────────────────────────┐
# │ 内核优化 (虚拟机专用) │
# └─────────────────────────────────────────────┘
CONFIG_VIRTUALIZATION=y
CONFIG_KVM_GUEST=y
CONFIG_PARAVIRT=y
CONFIG_PARAVIRT_SPINLOCKS=y
CONFIG_HYPERVISOR_GUEST=y
CONFIG_CPU_FREQ=y
CONFIG_CPU_FREQ_DEFAULT_GOV_PERFORMANCE=y
CONFIG_CPU_FREQ_GOV_PERFORMANCE=y
CONFIG_CPU_FREQ_GOV_ONDEMAND=y
CONFIG_TRANSPARENT_HUGEPAGE=y
CONFIG_TRANSPARENT_HUGEPAGE_ALWAYS=y
CONFIG_ZSWAP=y
CONFIG_ZPOOL=y
CONFIG_Z3FOLD=y
# ┌─────────────────────────────────────────────┐
# │ 虚拟机网络驱动 (精简优化) │
# └─────────────────────────────────────────────┘
CONFIG_PACKAGE_kmod-virtio=y
CONFIG_PACKAGE_kmod-virtio-net=y
CONFIG_PACKAGE_kmod-virtio-blk=y
CONFIG_PACKAGE_kmod-virtio-scsi=y
CONFIG_PACKAGE_kmod-virtio-balloon=y
CONFIG_PACKAGE_kmod-virtio-random=y
CONFIG_PACKAGE_kmod-e1000=y
CONFIG_PACKAGE_kmod-e1000e=y
CONFIG_PACKAGE_kmod-igc=n
CONFIG_PACKAGE_kmod-r8125=n
CONFIG_PACKAGE_kmod-r8168=n
CONFIG_PACKAGE_kmod-ixgbe=n
CONFIG_PACKAGE_kmod-igb=n
# ┌─────────────────────────────────────────────┐
# │ 网络优化配置 + SSR-Plus 终极补丁 │
# └─────────────────────────────────────────────┘
CONFIG_PACKAGE_kmod-tcp-bbr=y
CONFIG_PACKAGE_kmod-tcp-hybla=y
CONFIG_PACKAGE_kmod-shortcut-fe=y
CONFIG_PACKAGE_kmod-shortcut-fe-cm=y
CONFIG_PACKAGE_kmod-fast-classifier=y

# === SSR-Plus 全局代理终极 12 行补丁（体积 +<800KB）===
CONFIG_PACKAGE_kmod-nft-fullcone=y           # FullCone NAT → NAT 类型 1 + UDP 完美穿透
CONFIG_PACKAGE_kmod-nft-tproxy=y             # nftables 版 tproxy（新版 SSR-Plus 推荐）
CONFIG_PACKAGE_kmod-nft-offload=y            # 流卸载，高带宽下 CPU 占用暴降
CONFIG_PACKAGE_TURBOACC_ENABLE=y             # TurboACC 总开关
CONFIG_PACKAGE_TURBOACC_FULLCONE_NAT=y       # TurboACC FullCone 支持
CONFIG_PACKAGE_TURBOACC_DNS_CACHE=y          # DNS 缓存加速
CONFIG_PACKAGE_kmod-sched-cake=y             # CAKE 队列，高延迟线路神器
CONFIG_PACKAGE_kmod-sched-fq-codel=y         # fq_codel 备用
CONFIG_PACKAGE_kmod-sched-bfq=y              # BFQ（虚拟机磁盘也更顺滑）
CONFIG_PACKAGE_kmod-tcp-westwood=y           # westwood+ 弱网必备
CONFIG_PACKAGE_kmod-tcp-vegas=y              # vegas 超稳算法
CONFIG_PACKAGE_kmod-tcp-highspeed=y          # highspeed 高速网络算法
CONFIG_PACKAGE_kmod-tcp-illinois=y           # illinois 混合损耗/延迟算法
CONFIG_PACKAGE_kmod-tcp-scalable=y           # scalable 可扩展算法
CONFIG_PACKAGE_kmod-tcp-yeah=y               # yeah 混合算法
CONFIG_PACKAGE_dnsmasq=n                     # 你用 dnsmasq-full，关基础版防冲突
CONFIG_PACKAGE_odhcpd=n                      # 你只用 odhcpd-ipv6only，关完整版

# IPv6支持
CONFIG_PACKAGE_ipv6helper=y
CONFIG_PACKAGE_odhcpd-ipv6only=y
CONFIG_PACKAGE_odhcp6c=y
CONFIG_PACKAGE_6in4=y
CONFIG_PACKAGE_6rd=y
CONFIG_PACKAGE_6to4=y
# ┌─────────────────────────────────────────────┐
# │ 防火墙和流量控制 │
# └─────────────────────────────────────────────┘
CONFIG_PACKAGE_iptables=y
CONFIG_PACKAGE_iptables-mod-tproxy=y
CONFIG_PACKAGE_iptables-mod-extra=y
CONFIG_PACKAGE_iptables-mod-nat-extra=y
CONFIG_PACKAGE_iptables-mod-conntrack-extra=y
CONFIG_PACKAGE_kmod-ipt-tproxy=y
CONFIG_PACKAGE_kmod-ipt-nat=y
CONFIG_PACKAGE_kmod-ipt-conntrack=y
CONFIG_PACKAGE_kmod-nf-conntrack=y
CONFIG_PACKAGE_kmod-nf-conntrack-netlink=y
# ┌─────────────────────────────────────────────┐
# │ SSR-Plus 优化配置 │
# └─────────────────────────────────────────────┘
CONFIG_PACKAGE_luci-app-ssr-plus=y
CONFIG_PACKAGE_luci-i18n-ssr-plus-zh-cn=y
CONFIG_PACKAGE_shadowsocks-rust=y
CONFIG_PACKAGE_shadowsocks-rust-sslocal=y
CONFIG_PACKAGE_shadowsocks-rust-ssserver=y
CONFIG_PACKAGE_shadowsocks-rust-ssurl=y
CONFIG_PACKAGE_shadowsocks-rust-ssmanager=y
CONFIG_PACKAGE_shadowsocksr-libev=y
CONFIG_PACKAGE_shadowsocksr-libev-ssr-local=y
CONFIG_PACKAGE_shadowsocksr-libev-ssr-redir=y
CONFIG_PACKAGE_shadowsocksr-libev-ssr-server=y
CONFIG_PACKAGE_shadowsocksr-libev-ssr-check=y
CONFIG_PACKAGE_xray-core=y
CONFIG_PACKAGE_xray-plugin=y
CONFIG_PACKAGE_v2ray-geoip=y
CONFIG_PACKAGE_v2ray-geosite=y
CONFIG_PACKAGE_trojan-plus=y
CONFIG_PACKAGE_trojan-go=y
CONFIG_PACKAGE_simple-obfs=y
CONFIG_PACKAGE_simple-obfs-client=y
CONFIG_PACKAGE_kcptun-client=y
CONFIG_PACKAGE_kcptun-config=y
CONFIG_PACKAGE_redsocks2=y
CONFIG_PACKAGE_microsocks=y
CONFIG_PACKAGE_ipt2socks=y
CONFIG_PACKAGE_dns2socks=y
CONFIG_PACKAGE_dns2tcp=y
CONFIG_PACKAGE_chinadns-ng=y
CONFIG_PACKAGE_pdnsd-alt=y
CONFIG_PACKAGE_tcping=y
CONFIG_PACKAGE_resolveip=y
# CONFIG_PACKAGE_kmod-fs-ksmbd is not set
# CONFIG_PACKAGE_ksmbd-server is not set
# CONFIG_PACKAGE_luci-app-ksmbd is not set
# CONFIG_PACKAGE_luci-i18n-ksmbd-zh-cn is not set
# ┌─────────────────────────────────────────────┐
# │ MosDNS + SmartDNS 优化配置 │
# └─────────────────────────────────────────────┘
CONFIG_PACKAGE_mosdns=y
CONFIG_PACKAGE_luci-app-mosdns=y
CONFIG_PACKAGE_luci-i18n-mosdns-zh-cn=y
CONFIG_PACKAGE_smartdns=y
CONFIG_PACKAGE_luci-app-smartdns=y
CONFIG_PACKAGE_luci-i18n-smartdns-zh-cn=y
CONFIG_PACKAGE_bind-dig=y
CONFIG_PACKAGE_bind-host=y
CONFIG_PACKAGE_drill=y
CONFIG_PACKAGE_knot-dig=y
CONFIG_PACKAGE_dnsmasq-full=y
CONFIG_PACKAGE_dnsmasq_full_dhcp=y
CONFIG_PACKAGE_dnsmasq_full_dhcpv6=y
CONFIG_PACKAGE_dnsmasq_full_dnssec=y
CONFIG_PACKAGE_dnsmasq_full_auth=y
CONFIG_PACKAGE_dnsmasq_full_ipset=y
CONFIG_PACKAGE_dnsmasq_full_nftset=y
CONFIG_PACKAGE_dnsmasq_full_conntrack=y
CONFIG_PACKAGE_dnsmasq_full_noid=y
CONFIG_PACKAGE_dnsmasq_full_broken_rtc=y
CONFIG_PACKAGE_dnsmasq_full_tftp=y
# ┌─────────────────────────────────────────────┐
# │ 基础系统工具 │
# └─────────────────────────────────────────────┘
CONFIG_PACKAGE_curl=y
CONFIG_PACKAGE_wget-ssl=y
CONFIG_PACKAGE_nano=y
CONFIG_PACKAGE_htop=y
CONFIG_PACKAGE_iftop=y
CONFIG_PACKAGE_nload=y
CONFIG_PACKAGE_vnstat=y
CONFIG_PACKAGE_tcpdump=y
CONFIG_PACKAGE_iperf3=y
CONFIG_PACKAGE_mtr=y
CONFIG_PACKAGE_ss=y
CONFIG_PACKAGE_lsof=y
CONFIG_PACKAGE_openssh-sftp-server=y
CONFIG_PACKAGE_openssh-client=y
CONFIG_PACKAGE_openssh-keygen=y
CONFIG_PACKAGE_zram-swap=y
CONFIG_PACKAGE_block-mount=y
CONFIG_PACKAGE_e2fsprogs=y
# ┌─────────────────────────────────────────────┐
# │ LuCI界面配置 │
# └─────────────────────────────────────────────┘
CONFIG_PACKAGE_luci=y
CONFIG_PACKAGE_luci-base=y
CONFIG_PACKAGE_luci-mod-admin-full=y
CONFIG_PACKAGE_luci-theme-argon=y
CONFIG_PACKAGE_luci-app-argon-config=y
CONFIG_PACKAGE_luci-i18n-base-zh-cn=y
CONFIG_PACKAGE_luci-i18n-firewall-zh-cn=y
CONFIG_PACKAGE_luci-i18n-opkg-zh-cn=y
CONFIG_PACKAGE_luci-proto-ipv6=y
CONFIG_PACKAGE_luci-proto-ppp=y
# ┌─────────────────────────────────────────────┐
# │ 明确禁用的包 (节省空间) │
# └─────────────────────────────────────────────┘
CONFIG_PACKAGE_hostapd=n
CONFIG_PACKAGE_hostapd-common=n
CONFIG_PACKAGE_wpad=n
CONFIG_PACKAGE_wpad-basic=n
CONFIG_PACKAGE_wpad-mini=n
CONFIG_PACKAGE_iw=n
CONFIG_PACKAGE_iwinfo=n
CONFIG_PACKAGE_kmod-cfg80211=n
CONFIG_PACKAGE_kmod-mac80211=n
CONFIG_PACKAGE_kmod-ath=n
CONFIG_PACKAGE_kmod-ath9k=n
CONFIG_PACKAGE_kmod-mt76=n
CONFIG_PACKAGE_kmod-rt2800=n
CONFIG_PACKAGE_kmod-usb-core=n
CONFIG_PACKAGE_kmod-usb-ohci=n
CONFIG_PACKAGE_kmod-usb-uhci=n
CONFIG_PACKAGE_kmod-usb2=n
CONFIG_PACKAGE_kmod-usb3=n
CONFIG_PACKAGE_kmod-usb-storage=n
CONFIG_PACKAGE_luci-app-adbyby-plus=n
CONFIG_PACKAGE_luci-app-unblockmusic=n
CONFIG_PACKAGE_luci-app-xlnetacc=n
CONFIG_PACKAGE_luci-app-zerotier=n
CONFIG_PACKAGE_luci-app-ipsec-vpnd=n
CONFIG_PACKAGE_luci-app-vsftpd=n
CONFIG_PACKAGE_luci-app-samba=n
CONFIG_PACKAGE_luci-app-samba4=n
# CONFIG_PACKAGE_luci-app-ksmbd is not set
CONFIG_PACKAGE_luci-app-accesscontrol=n
CONFIG_PACKAGE_luci-app-ddns=n
CONFIG_PACKAGE_luci-app-nlbwmon=n
CONFIG_PACKAGE_luci-app-wol=n
CONFIG_PACKAGE_luci-app-qbittorrent=n
CONFIG_PACKAGE_luci-app-transmission=n
CONFIG_PACKAGE_luci-app-dockerman=n
CONFIG_PACKAGE_luci-app-diskman=n
CONFIG_PACKAGE_luci-app-ttyd=n
CONFIG_PACKAGE_luci-app-wireguard=n
CONFIG_PACKAGE_luci-app-frpc=n
CONFIG_PACKAGE_luci-app-frps=n
# ┌─────────────────────────────────────────────┐
# │ 编译优化选项 │
# └─────────────────────────────────────────────┘
CONFIG_KERNEL_BUILD_DOMAIN="vm.local"
CONFIG_KERNEL_BUILD_USER="openwrt"
CONFIG_PACKAGE_TURBOACC_INCLUDE_SHORTCUT_FE=y
CONFIG_PACKAGE_TURBOACC_INCLUDE_BBR_CCA=y
CONFIG_GCC_USE_VERSION_11=y
CONFIG_GCC_VERSION_11=y
CONFIG_GCC_USE_GRAPHITE=y
CONFIG_KERNEL_GZIP=y
CONFIG_TARGET_ROOTFS_SQUASHFS=y
CONFIG_TARGET_SQUASHFS_BLOCK_SIZE=256
CONFIG_KERNEL_DEBUG_FS=n
CONFIG_KERNEL_DEBUG_KERNEL=n
CONFIG_KERNEL_DEBUG_INFO=n
CONFIG_PACKAGE_kmod-usb-serial=n
CONFIG_PACKAGE_kmod-usb-serial-ftdi=n
# 开启upnp
CONFIG_PACKAGE_miniupnpd=y
CONFIG_PACKAGE_miniupnpd-nft=y
CONFIG_PACKAGE_luci-app-upnp=y
CONFIG_PACKAGE_luci-i18n-upnp-zh-cn=y

# ==================================================
# 终极说明（2025最新）：
# 1. 已加入 FullCone + TurboACC 全开 + 拥塞控制全家桶
# 2. 固件体积只增加 ~700KB，几乎无感
# 3. SSR-Plus 全局代理性能已达虚拟机环境天花板
# ==================================================
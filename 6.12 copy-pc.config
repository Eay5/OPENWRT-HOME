# ==================================================
# OpenWrt 配置 - 针对 x86_64 高性能物理机优化
# 硬件配置: 8核16线程 (性能稳定版)
# ==================================================
#
# 🎯 设计理念: 性能优先 + 稳定可靠
#
# 🚀 核心特性:
# - Intel I225/I226 2.5G 网卡驱动 (高速网络)
# - TCP BBR 拥塞控制算法 (网络性能优化)
# - IRQ Balance (多核中断平衡，充分利用8核)
# - Lucky (DDNS + 端口转发)
# - SmartDNS (DNS优化与分流)
# - SSR Plus+ (代理工具)
# - 精简应用，减少资源占用，保证稳定性
#
# 📝 编译建议:
# make -j16 V=s  (利用全部16线程编译)
#
# ==================================================

# --------------------------------------------------
# 目标平台配置 (Target System Configuration)
# --------------------------------------------------
CONFIG_TARGET_x86=y
CONFIG_TARGET_x86_64=y
CONFIG_TARGET_x86_64_DEVICE_generic=y

# --------------------------------------------------
# 固件镜像构建配置 (Image Build Configuration)
# --------------------------------------------------
CONFIG_GRUB_IMAGES=y
CONFIG_PACKAGE_grub2-efi=y
CONFIG_EFI_IMAGES=y                     # 支持EFI启动 (现代物理机必需)
CONFIG_TARGET_IMAGES_GZIP=y
CONFIG_TARGET_ROOTFS_PARTSIZE=2048      # 2GB足够 (专注路由功能，不跑额外服务)

# --------------------------------------------------
# 基本系统和实用工具 (Base System & Utilities)
# --------------------------------------------------
CONFIG_PACKAGE_6in4=y                   # IPv6-in-IPv4 隧道支持
CONFIG_PACKAGE_curl=y                   # URL 传输命令行工具
CONFIG_PACKAGE_nano=y                   # 一个简单的文本编辑器
CONFIG_PACKAGE_wget=y                   # 非交互式网络下载器
CONFIG_PACKAGE_openssl-util=y           # OpenSSL 命令行工具
CONFIG_PACKAGE_snmpd=y                  # SNMP 守护进程 (用于网络监控)
CONFIG_PACKAGE_htop=y                   # 交互式进程查看器 (物理机推荐)
CONFIG_PACKAGE_lm-sensors=y             # 硬件传感器监控 (温度/风扇/电压监控)
CONFIG_PACKAGE_ethtool=y                # 网卡诊断工具 (查看网卡状态/速率/驱动信息)
CONFIG_PACKAGE_iperf3=y                 # 网络性能测试工具
CONFIG_PACKAGE_pciutils=y               # PCI 设备查看工具 (lspci)
CONFIG_PACKAGE_usbutils=y               # USB 设备查看工具 (lsusb)
CONFIG_PACKAGE_bash=y                   # Bash Shell (脚本支持)
CONFIG_PACKAGE_rsync=y                  # 文件同步工具

# --------------------------------------------------
# 网络 - 驱动程序 (物理机优化) (Networking - Drivers (Physical Machine Optimized))
# --------------------------------------------------
# --- Intel 网卡驱动 (物理机) ---
CONFIG_PACKAGE_kmod-e1000=y             # Intel PRO/1000 千兆网卡驱动 (兼容性)
CONFIG_PACKAGE_kmod-e1000e=y            # Intel PRO/1000 PCIe 千兆网卡驱动 (常见Intel网卡)
CONFIG_PACKAGE_kmod-igb=y               # Intel I210/I211/I350 千兆网卡驱动
CONFIG_PACKAGE_kmod-igc=y               # Intel I225/I226 2.5G 网卡驱动 ★物理机必备★
CONFIG_PACKAGE_kmod-ixgbe=y             # Intel 82599/X520/X540/X550 万兆网卡驱动

# --- Realtek 网卡驱动 (物理机备用) ---
CONFIG_PACKAGE_kmod-r8125=y             # Realtek RTL8125 2.5G 网卡驱动
CONFIG_PACKAGE_kmod-r8168=y             # Realtek RTL8111/8168 千兆网卡驱动

# --- 无线网卡驱动 (如有需要可启用) ---
# CONFIG_PACKAGE_kmod-ath9k=y           # Atheros 802.11n 无线网卡
# CONFIG_PACKAGE_kmod-ath10k=y          # Atheros 802.11ac 无线网卡
# CONFIG_PACKAGE_kmod-mt76=y            # MediaTek MT76xx 无线网卡
# CONFIG_PACKAGE_kmod-iwlwifi=y         # Intel 无线网卡

# --- 虚拟机网络驱动 (物理机可选，保留以便迁移) ---
CONFIG_PACKAGE_kmod-vmxnet3=n           # VMware VMXNET3 (物理机不需要)
CONFIG_PACKAGE_kmod-virtio-net=n        # VirtIO 网卡 (物理机不需要)

# --------------------------------------------------
# 存储驱动 (物理机优化) (Storage Drivers (Physical Machine Optimized))
# --------------------------------------------------
# --- USB 存储支持 (物理机推荐) ---
CONFIG_PACKAGE_kmod-usb-storage=y       # USB 存储基础支持
CONFIG_PACKAGE_kmod-usb-storage-extras=y # USB 存储额外驱动
CONFIG_PACKAGE_kmod-usb-storage-uas=y   # USB 3.0 UAS 高速传输支持
CONFIG_PACKAGE_kmod-usb2=y              # USB 2.0 支持
CONFIG_PACKAGE_kmod-usb3=y              # USB 3.0 支持

# --- 文件系统支持 (物理机推荐) ---
CONFIG_PACKAGE_kmod-fs-ext4=y           # EXT4 文件系统支持
CONFIG_PACKAGE_kmod-fs-ntfs3=y          # NTFS 文件系统支持 (读写)
CONFIG_PACKAGE_kmod-fs-vfat=y           # FAT/FAT32 文件系统支持
CONFIG_PACKAGE_kmod-fs-exfat=y          # exFAT 文件系统支持

# --- 虚拟化存储驱动 (物理机不需要) ---
CONFIG_PACKAGE_kmod-virtio-blk=n        # VirtIO 块设备 (物理机不需要)
CONFIG_PACKAGE_kmod-virtio-scsi=n       # VirtIO SCSI (物理机不需要)

# --------------------------------------------------
# 网络 - 服务与协议 (Networking - Services & Protocols)
# --------------------------------------------------
# --- IPv6 支持 ---
CONFIG_PACKAGE_ipv6helper=y             # IPv6 辅助工具
CONFIG_PACKAGE_luci-proto-ipv6=y        # LuCI 界面的 IPv6 协议支持
CONFIG_PACKAGE_luci-proto-ppp=y         # LuCI 界面的 PPP 协议支持 (含 PPPoE)
CONFIG_PACKAGE_odhcpd-ipv6only=y        # DHCPv6 服务器
CONFIG_PACKAGE_odhcp6c=y                # DHCPv6 客户端

# --- 防火墙 (使用旧版 iptables) ---
CONFIG_PACKAGE_iptables=y               # 包含 iptables 工具集
CONFIG_PACKAGE_firewall4=n             # 禁用 firewall4 (基于 nftables 的新防火墙)。请确保所选插件与 iptables 兼容!

# --- SSH/SFTP ---
CONFIG_PACKAGE_openssh-sftp-server=y    # 通过 OpenSSH 提供 SFTP 服务

# --- UPnP 端口映射 ---
CONFIG_PACKAGE_miniupnpd=y              # UPnP/NAT-PMP 守护进程
CONFIG_PACKAGE_luci-app-upnp=y          # UPnP LuCI 界面 (物理机路由器常用)

# --------------------------------------------------
# LuCI 网页界面及应用 (LuCI Web Interface & Applications)
# --------------------------------------------------
# --- LuCI 核心 ---
# (假设基础 LuCI 包如 luci, luci-base, luci-lib-ipkg 等默认已包含)

# --- LuCI 主题 ---
CONFIG_PACKAGE_luci-theme-argon=y       # Argon 主题包本身
CONFIG_PACKAGE_luci-app-argon-config=y  # Argon 主题配置工具

# --- LuCI 应用 (启用) ---
CONFIG_PACKAGE_luci-app-lucky=y         # Lucky - DDNS 及端口转发工具 ★已启用★
CONFIG_PACKAGE_luci-app-smartdns=y      # SmartDNS - DNS 优化与分流器
CONFIG_PACKAGE_luci-app-ssr-plus=y      # ShadowsocksR Plus+ 客户端

# --- LuCI 应用 (明确禁用) ---
CONFIG_PACKAGE_luci-app-adbyby-plus=n   # adbyby 广告过滤
CONFIG_PACKAGE_luci-app-adguardhome=n   # AdGuard Home (资源占用较大，已有SmartDNS)
CONFIG_PACKAGE_luci-app-accesscontrol=n # 访问控制
CONFIG_PACKAGE_luci-app-argone-config=n # (如果用了 argon-config, 这个应禁用以避免混淆)
CONFIG_PACKAGE_luci-app-autoreboot=n    # 自动重启
CONFIG_PACKAGE_luci-app-bandwidthd=n    # 带宽监控 (旧版)
CONFIG_PACKAGE_luci-app-bypass=n        # Bypass (类似 VSSR 或 Passwall 的另一代理工具)
CONFIG_PACKAGE_luci-app-ddns=n          # 动态 DNS (官方版)
CONFIG_PACKAGE_luci-app-ddns-go=n       # DDNS-Go 动态 DNS
CONFIG_PACKAGE_luci-app-ddnsto=n        # DDNSTO 内网穿透
CONFIG_PACKAGE_luci-app-diskman=y       # 磁盘管理 ★物理机推荐★
CONFIG_PACKAGE_luci-app-dockerman=n     # Docker (不需要，专注路由功能)
CONFIG_PACKAGE_luci-app-fchomo=n        # Fchomo 代理工具
CONFIG_PACKAGE_luci-app-fileassistant=n # 文件助手
CONFIG_PACKAGE_luci-app-filetransfer=n  # 文件传输
CONFIG_PACKAGE_luci-app-frpc=n          # FRP 客户端
CONFIG_PACKAGE_luci-app-frps=n          # FRP 服务端
CONFIG_PACKAGE_luci-app-godproxy=n      # GodProxy 代理
CONFIG_PACKAGE_luci-app-ipsec-vpnd=n    # IPSec VPN 服务端
CONFIG_PACKAGE_luci-app-mosdns=n        # MosDNS - 另一款 DNS 分流器
CONFIG_PACKAGE_luci-app-netdata=n       # Netdata (资源占用较大，保持精简)
CONFIG_PACKAGE_luci-app-nlbwmon=y       # 网络带宽监控 ★物理机推荐★
CONFIG_PACKAGE_luci-app-openclash=n     # OpenClash - Clash 客户端
# CONFIG_PACKAGE_luci-app-passwall=n    # Passwall 代理客户端 (明确禁用)
# (Passwall 相关选项保持注释/禁用状态, 根据原始请求)
CONFIG_PACKAGE_luci-app-qbittorrent=n   # qBittorrent (不需要下载功能)
CONFIG_PACKAGE_luci-app-samba=n         # Samba (旧版, 文件共享)
CONFIG_PACKAGE_luci-app-samba4=n        # Samba4 (不需要NAS功能)
CONFIG_PACKAGE_luci-app-socat=n         # Socat 网络工具中继
CONFIG_PACKAGE_luci-app-sqm=y           # SQM QoS (智能队列管理) ★网络延迟优化★
CONFIG_PACKAGE_luci-app-statistics=n    # 系统状态统计 (保持精简)
CONFIG_PACKAGE_luci-app-store=n         # OpenWrt 应用商店 (非官方)
CONFIG_PACKAGE_luci-app-transmission=n  # Transmission 下载器
CONFIG_PACKAGE_luci-app-ttyd=y          # TTYD 网页终端 ★物理机推荐★
CONFIG_PACKAGE_luci-app-unblockmusic=n  # 解锁网易云灰色歌曲
CONFIG_PACKAGE_luci-app-vlmcsd=n        # KMS 激活服务器
CONFIG_PACKAGE_luci-app-vsftpd=n        # Vsftpd FTP 服务器的 LuCI 界面
CONFIG_PACKAGE_luci-app-wireguard=n     # WireGuard VPN
CONFIG_PACKAGE_luci-app-wol=y           # 网络唤醒 (Wake on LAN) ★物理机实用★
CONFIG_PACKAGE_luci-app-xlnetacc=n      # 迅雷快鸟加速
CONFIG_PACKAGE_luci-app-zerotier=n      # ZeroTier 内网穿透

# --------------------------------------------------
# SSR Plus+ 相关包 (必需) (SSR Plus+ Required Packages)
# --------------------------------------------------
CONFIG_PACKAGE_luci-app-ssr-plus=y
CONFIG_PACKAGE_shadowsocks-libev-ss-local=y
CONFIG_PACKAGE_shadowsocks-libev-ss-redir=y
CONFIG_PACKAGE_shadowsocks-libev-ss-server=y
CONFIG_PACKAGE_shadowsocksr-libev-ssr-local=y
CONFIG_PACKAGE_shadowsocksr-libev-ssr-redir=y
CONFIG_PACKAGE_simple-obfs=y
CONFIG_PACKAGE_v2ray-core=y
CONFIG_PACKAGE_v2ray-plugin=y
CONFIG_PACKAGE_xray-core=y
CONFIG_PACKAGE_xray-plugin=y
CONFIG_PACKAGE_trojan-plus=y
CONFIG_PACKAGE_trojan-go=y
CONFIG_PACKAGE_naiveproxy=y
CONFIG_PACKAGE_redsocks2=y
CONFIG_PACKAGE_kcptun-client=y
CONFIG_PACKAGE_dns2socks=y
CONFIG_PACKAGE_dns2tcp=y
CONFIG_PACKAGE_microsocks=y
CONFIG_PACKAGE_ipt2socks=y

# --------------------------------------------------
# 其他系统级配置 (System Level Configuration)
# --------------------------------------------------
CONFIG_PACKAGE_acpid=y                  # ACPI 守护进程 (物理机推荐启用，支持电源管理)
CONFIG_PACKAGE_autosamba=n              # 自动发现 Samba 共享
CONFIG_PACKAGE_block-mount=y            # 块设备挂载工具 (物理机可能需要挂载额外磁盘)
CONFIG_PACKAGE_fdisk=y                  # 磁盘分区工具
CONFIG_PACKAGE_parted=y                 # 高级分区工具
CONFIG_DOCKER_OPTIONAL_FEATURES=n
CONFIG_PACKAGE_geoview=n                # GeoIP 查看工具 (曾报告有依赖问题)
CONFIG_PACKAGE_nikki=n                  # 未知包 'nikki' (曾报告有依赖问题)
# CONFIG_PACKAGE_vsftpd=n               # Vsftpd FTP 服务器 (已启用基于 SSH 的 SFTP)

# --------------------------------------------------
# 性能与稳定性优化 (Performance & Stability - 8核16线程专注版)
# --------------------------------------------------
CONFIG_PACKAGE_irqbalance=y             # 中断平衡守护进程 ★多核必备，自动分配网络中断★

# --- 网络性能优化 (核心) ---
CONFIG_PACKAGE_kmod-tcp-bbr=y           # TCP BBR 拥塞控制算法 ★显著提升网络吞吐量★
CONFIG_PACKAGE_kmod-nf-conntrack-netlink=y # Netfilter 连接跟踪 (高性能防火墙)
CONFIG_PACKAGE_tc=y                     # 流量控制工具 (配合SQM使用)
CONFIG_PACKAGE_iptables-mod-conntrack-extra=y # 高级连接跟踪
CONFIG_PACKAGE_iptables-mod-extra=y     # iptables 额外模块
CONFIG_PACKAGE_iptables-mod-ipopt=y     # IP 选项模块

# --- 系统稳定性 ---
CONFIG_PACKAGE_watchcat=y               # 系统监控守护进程 (自动重启故障进程)
CONFIG_PACKAGE_logrotate=y              # 日志轮转工具 (防止日志占满磁盘)

# ==================================================
# 性能与稳定性说明 (8核16线程 路由专用版)
# ==================================================
# 
# 🎯 设计原则:
# - 精简应用，减少资源占用
# - 专注网络转发性能
# - 多核负载均衡 (IRQ Balance)
# - 优化网络协议栈 (TCP BBR)
# - 系统稳定性保障 (watchcat)
#
# ⚡ 性能优化:
# 1. IRQ Balance: 自动将网卡中断分配到不同CPU核心
# 2. TCP BBR: 在高延迟/丢包网络下性能提升20%-50%
# 3. SQM QoS: 消除缓冲膨胀，降低延迟抖动
# 4. 多网卡驱动: 支持Intel/Realtek 2.5G网卡
#
# 🛡️ 稳定性保障:
# 1. watchcat: 监控系统，自动恢复故障
# 2. logrotate: 自动清理日志，防止磁盘满
# 3. 精简应用: 减少软件冲突和资源竞争
# 4. 专注路由: 不跑额外服务，系统负载低
#
# 📊 预期表现:
# - CPU平均负载: <10% (正常使用)
# - 内存占用: <500MB (稳定运行)
# - 网络吞吐: 接近线速 (2.5G网卡可达2.3Gbps+)
# - 系统稳定: 连续运行数月无需重启
#
# ==================================================

# ==================================================
# 配置结束 (End of Configuration)
# ==================================================